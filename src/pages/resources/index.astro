---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import CTA from '../../components/CTA.astro';
import { getAllPosts } from '../../utils/blog';
import { getBreadcrumbSchema } from '../../utils/schema';
import { truncateAtWord } from '../../utils/text';

const breadcrumbs = [
  { label: 'Home', url: '/' },
  { label: 'Resources', url: '/resources/' },
];

const schema = [getBreadcrumbSchema(breadcrumbs)];

const posts = await getAllPosts();
const fallbackImage = '/images/flooring-commercial-flooring-inner-image-1.jpg';

/** Max chars for card title (≈2 lines) and description (≈3 lines) so we truncate at word boundaries */
const TITLE_MAX = 70;
const DESC_MAX = 160;
---

<BaseLayout
  title="Commercial Flooring Blog | Guides & Resources"
  description="Guides, tips, and articles for commercial flooring projects. Cost guides, planning, moisture mitigation, and best practices for property managers and building owners."
  schema={schema}
>
  <main id="main-content" class="pt-24">
    <section class="px-4 md:px-15 py-16 bg-charcoal text-white">
      <div class="max-w-7xl mx-auto">
        <Breadcrumbs items={breadcrumbs} />
        <h1 class="text-5xl md:text-6xl font-heading font-extrabold mb-6">Commercial Flooring Blog</h1>
        <p class="text-xl text-gray-mid max-w-3xl">
          Guides, tips, and information to help you plan and execute successful commercial flooring projects.
        </p>
      </div>
    </section>

    <section class="px-4 md:px-15 py-20">
      <div class="max-w-7xl mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" data-reveal-children>
          {posts.map((post) => {
            const cardImage = post.data.image ?? fallbackImage;
            const cardAlt = post.data.imageAlt ?? post.data.title;
            return (
              <article class="relative min-h-[320px] overflow-hidden border border-gray-200 hover:border-ochre transition-colors group">
                <div class="absolute inset-0">
                  <img
                    src={cardImage}
                    alt={cardAlt}
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                    loading="lazy"
                    width="600"
                    height="400"
                  />
                </div>
                <div class="absolute inset-0 bg-charcoal/70 group-hover:bg-charcoal/80 transition-colors"></div>
                <div class="relative z-10 flex flex-col h-full p-8">
                  <h2 class="text-xl md:text-2xl font-heading font-bold mb-2">
                    <a href={`/resources/${post.slug}/`} class="text-white no-underline hover:text-ochre transition-colors">
                      {post.data.title.length > TITLE_MAX ? truncateAtWord(post.data.title, TITLE_MAX) : post.data.title}
                    </a>
                  </h2>
                  <p class="text-gray-200 text-sm md:text-base mb-3 flex-grow min-h-[3.75rem]">
                    {post.data.description.length > DESC_MAX ? truncateAtWord(post.data.description, DESC_MAX) : post.data.description}
                  </p>
                  <time datetime={post.data.pubDate.toISOString()} class="text-sm text-gray-300 block mb-3">
                    {post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
                  </time>
                  {post.data.tags && post.data.tags.length > 0 && (
                    <p class="text-xs text-gray-200 mb-4 flex-shrink-0 flex flex-wrap gap-x-1.5 items-center" aria-label="Tags">
                      {post.data.tags.slice(0, 3).map((tag, i) => (
                        <span class="inline-flex items-center gap-x-1.5">
                          {i > 0 && <span class="text-gray-400" aria-hidden="true">·</span>}
                          <a
                            href={`/resources/tag/${encodeURIComponent(tag)}/`}
                            class="uppercase tracking-wide text-ochre hover:underline no-underline"
                          >
                            {tag.replace(/-/g, ' ')}
                          </a>
                        </span>
                      ))}
                    </p>
                  )}
                  <a
                    href={`/resources/${post.slug}/`}
                    class="mt-auto pt-2 text-sm font-semibold uppercase tracking-wide text-white hover:text-ochre transition-colors border-t border-white/20 flex-shrink-0 no-underline inline-block"
                  >
                    Read more →
                  </a>
                </div>
              </article>
            );
          })}
        </div>
      </div>
    </section>

    <section class="px-4 md:px-15 py-20 bg-gray-light">
      <div class="max-w-4xl mx-auto text-center" data-reveal>
        <h2 class="text-4xl font-heading font-bold mb-6">Ready to Start Your Project?</h2>
        <p class="text-xl text-gray-dark mb-8">
          Contact us for a free site walk and detailed proposal for your commercial flooring project.
        </p>
        <CTA />
      </div>
    </section>
  </main>
</BaseLayout>
